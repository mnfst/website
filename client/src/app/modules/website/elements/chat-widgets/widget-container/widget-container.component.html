<!-- App Bar (displayed above any widget when configured) -->
@if (config.appBar) {
<div
  class="widget-container__app-bar"
  [class.widget-container__app-bar--sales]="config.appBar.logo === 'sales'"
>
  <div class="widget-container__app-bar-left">
    <div
      class="widget-container__app-logo"
      [class.widget-container__app-logo--sales]="config.appBar.logo === 'sales'"
    >
      @if (config.appBar.logo === 'sales') {
      <svg width="16" height="16" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M20 0C25.3043 4.00466e-07 30.3919 2.10669 34.1426 5.85742C34.8157 6.53058 35.4354 7.24719 36 8H20C16.8174 8 13.7651 9.26421 11.5146 11.5146C9.26421 13.7651 8 16.8174 8 20H20L36.9102 9.31934C38.1656 11.3074 39.0611 13.5027 39.5547 15.8027L32 20H40L39.9941 20.4971C39.8669 25.6213 37.776 30.5092 34.1426 34.1426C30.3919 37.8933 25.3043 40 20 40C14.6957 40 9.60815 37.8933 5.85742 34.1426C5.18426 33.4694 4.56459 32.7528 4 32H20C23.1826 32 26.2349 30.7358 28.4854 28.4854C30.5952 26.3755 31.8383 23.5608 31.9854 20.5947L32 20H20L3.08984 30.6787C1.83452 28.6906 0.941002 26.4951 0.447266 24.1953L8 20H0C8.00931e-07 14.6957 2.1067 9.60815 5.85742 5.85742C9.60815 2.1067 14.6957 -5.79361e-10 20 0Z" fill="currentColor"/>
      </svg>
      } @else {
      <svg
        width="14"
        height="10"
        viewBox="0 0 58 40"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          fill-rule="evenodd"
          clip-rule="evenodd"
          d="M24.6625 0C29.5499 0.000157557 33.512 3.87456 33.5121 8.65224C33.5121 8.91866 33.4997 9.18398 33.4824 9.44828H40.9366C48.1871 9.44828 51.0342 18.6407 45.0014 22.5723L37.1131 27.7122C35.415 28.8193 35.8805 31.3743 37.8654 31.84C38.5143 31.9921 39.1997 31.8658 39.7475 31.4934L44.3242 28.1927C44.4979 28.0675 44.7074 28 44.9225 28H57.4922C57.9872 28 58.1886 28.6281 57.7838 28.909L44.4783 38.1397C41.99 39.8319 38.8796 40.4048 35.9321 39.7133C26.9186 37.5986 24.8061 26.0015 32.5185 20.9749L37.7818 17.5457H29.7048H24.5358C23.0515 17.5457 21.6504 17.1926 20.4171 16.5691C21.7314 17.4535 24.9805 18.4377 27.7216 18.6251C27.9658 18.6251 28.3625 18.8385 27.8901 19.3183L11.2952 35.7067C11.105 35.8945 10.847 36 10.578 36H0.507884C0.056246 36 -0.169872 35.4613 0.149574 35.1463L19.5219 16.0472C17.1349 14.4709 15.5652 11.8013 15.5649 8.77349C15.5649 3.92875 19.5825 0 24.5385 0H24.6625ZM24.8419 6.74915C23.6982 6.74915 22.771 7.35337 22.771 8.09871C22.7715 8.71319 23.4024 9.23009 24.2648 9.39292C24.3487 9.42847 24.4413 9.44828 24.5385 9.44828H25.1533C25.1544 9.44225 25.1535 9.43586 25.1546 9.42983C26.1495 9.33152 26.9122 8.77441 26.9127 8.09871C26.9127 7.35337 25.9855 6.74915 24.8419 6.74915Z"
          fill="currentColor"
        />
      </svg>
      }
    </div>
    <span class="widget-container__app-bar-name">{{ config.appBar.name }}</span>
  </div>
  <div class="widget-container__app-bar-right">
    <button class="widget-container__feedback-btn">
      <svg
        width="14"
        height="14"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path
          d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"
        />
      </svg>
    </button>
    <button class="widget-container__feedback-btn">
      <svg
        width="14"
        height="14"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path
          d="M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3zm7-13h2.67A2.31 2.31 0 0 1 22 4v7a2.31 2.31 0 0 1-2.33 2H17"
        />
      </svg>
    </button>
  </div>
</div>
}

@if (config.style === 'sales') {
<!-- Sales-style widget (LIGHT THEME) -->
<div class="widget-container widget-container--sales">
  <!-- Sales header -->
  <div class="widget-container__sales-header">
    <div class="widget-container__sales-header-left">
      @if (config.header?.title) {
      <h3 class="widget-container__sales-title">{{ config.header.title }}</h3>
      }
      @if (config.header?.subtitle) {
      <span class="widget-container__sales-subtitle">{{ config.header.subtitle }}</span>
      }
    </div>
    <div class="widget-container__sales-header-right">
      @if (config.header?.badge) {
      <div class="widget-container__sales-badge" [class.widget-container__sales-badge--live]="config.header.badge.type === 'live'">
        <span class="widget-container__sales-badge-dot"></span>
        <span>{{ config.header.badge.label }}</span>
      </div>
      }
    </div>
  </div>

  <!-- Sales body -->
  <div class="widget-container__sales-body">
    <ng-container *ngTemplateOutlet="widgetSectionsSales"></ng-container>
  </div>
</div>
} @else if (config.style === 'browser') {
<!-- Browser-style widget -->
<div class="widget-container widget-container--browser">
  <div class="widget-container__content">
    @if (config.header?.title || config.header?.badge) {
    <div class="widget-container__app-header">
      <div class="widget-container__app-title">
        @if (config.header?.icon) {
        <div class="widget-container__app-icon">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 2L2 7l10 5 10-5-10-5z" />
            <path d="M2 17l10 5 10-5" />
            <path d="M2 12l10 5 10-5" />
          </svg>
        </div>
        }
        @if (config.header?.title) {
        <h3 class="widget-container__app-name">{{ config.header.title }}</h3>
        }
      </div>
      @if (config.header?.badge) {
      <div class="widget-container__app-badge">
        <span class="widget-container__app-badge-dot"></span>
        <span>{{ config.header.badge.label }}</span>
      </div>
      }
    </div>
    }
    <div class="widget-container__body">
      <ng-container *ngTemplateOutlet="widgetSections"></ng-container>
    </div>
  </div>
</div>
} @else {
<!-- HRIS-style widget (DARK THEME) -->
<div class="widget-container widget-container--hris">
  @if (config.header?.badge) {
  <div class="widget-container__hris-header">
    <div class="widget-container__hris-badge">
      <span class="widget-container__hris-badge-dot"></span>
      <span>{{ config.header.badge.label }}</span>
    </div>
  </div>
  }
  <div class="widget-container__hris-body">
    @if (config.header?.title) {
    <div class="widget-container__title-row">
      <h3 class="widget-container__title">{{ config.header.title }}</h3>
      @if (config.header?.subtitle) {
      <span class="widget-container__period">{{ config.header.subtitle }}</span>
      }
    </div>
    }
    <ng-container *ngTemplateOutlet="widgetSections"></ng-container>
  </div>
</div>
}

<!-- Widget Sections Template (Dark theme) -->
<ng-template #widgetSections>
  @for (section of config.sections; track $index) {
    @switch (section.type) {
      @case ('stat-grid') {
        <app-stat-grid-widget [data]="asStatGrid(section)"></app-stat-grid-widget>
      }
      @case ('bar-chart') {
        <app-bar-chart-widget [data]="asBarChart(section)"></app-bar-chart-widget>
      }
      @case ('data-table') {
        <app-data-table-widget [data]="asDataTable(section)"></app-data-table-widget>
      }
      @case ('data-grid') {
        <app-data-grid-widget [data]="asDataGrid(section)"></app-data-grid-widget>
      }
      @case ('action-buttons') {
        <app-action-buttons-widget [data]="asActionButtons(section)" [theme]="'dark'"></app-action-buttons-widget>
      }
      @case ('pipeline') {
        <app-pipeline-widget [data]="asPipeline(section)"></app-pipeline-widget>
      }
      @case ('deal-cards') {
        <app-deal-cards-widget [data]="asDealCards(section)"></app-deal-cards-widget>
      }
    }
  }
</ng-template>

<!-- Widget Sections Template (Light theme for Sales) -->
<ng-template #widgetSectionsSales>
  @for (section of config.sections; track $index) {
    @switch (section.type) {
      @case ('stat-grid') {
        <app-stat-grid-widget [data]="asStatGrid(section)" [theme]="'light'"></app-stat-grid-widget>
      }
      @case ('bar-chart') {
        <app-bar-chart-widget [data]="asBarChart(section)" [theme]="'light'"></app-bar-chart-widget>
      }
      @case ('data-table') {
        <app-data-table-widget [data]="asDataTable(section)" [theme]="'light'"></app-data-table-widget>
      }
      @case ('data-grid') {
        <app-data-grid-widget [data]="asDataGrid(section)" [theme]="'light'"></app-data-grid-widget>
      }
      @case ('action-buttons') {
        <app-action-buttons-widget [data]="asActionButtons(section)" [theme]="'light'"></app-action-buttons-widget>
      }
      @case ('pipeline') {
        <app-pipeline-widget [data]="asPipeline(section)" [theme]="'light'"></app-pipeline-widget>
      }
      @case ('deal-cards') {
        <app-deal-cards-widget [data]="asDealCards(section)" [theme]="'light'"></app-deal-cards-widget>
      }
    }
  }
</ng-template>
