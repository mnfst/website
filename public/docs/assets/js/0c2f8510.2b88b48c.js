"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[374],{3809:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>i,metadata:()=>n,toc:()=>u});const n=JSON.parse('{"id":"upload","title":"Uploads","description":"Introduction","source":"@site/content/upload.md","sourceDirName":".","slug":"/upload","permalink":"/docs/upload","draft":false,"unlisted":false,"editUrl":"https://github.com/mnfst/docs/blob/master/upload.md","tags":[],"version":"current","frontMatter":{"id":"upload"},"sidebar":"docSidebar","previous":{"title":"Middlewares","permalink":"/docs/middlewares"},"next":{"title":"S3 Storage","permalink":"/docs/s3-storage"}}');var r=t(4848),l=t(8453),o=t(5537),s=t(9329);const i={id:"upload"},c="Uploads",d={},u=[{value:"Introduction",id:"introduction",level:2},{value:"Add a BASE_URL variable",id:"add-a-base_url-variable",level:2},{value:"Upload a file",id:"upload-a-file",level:2},{value:"Upload an image",id:"upload-an-image",level:2}];function p(e){const a={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",strong:"strong",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(a.header,{children:(0,r.jsx)(a.h1,{id:"uploads",children:"Uploads"})}),"\n",(0,r.jsx)(a.h2,{id:"introduction",children:"Introduction"}),"\n",(0,r.jsxs)(a.p,{children:["Manifest comes with a ",(0,r.jsx)(a.strong,{children:"built-in storage system"})," to upload assets locally (default) or in a ",(0,r.jsx)(a.a,{href:"./s3-storage",children:"S3 bucket"}),". You can use ",(0,r.jsx)(a.a,{href:"#upload-a-file",children:"file upload"})," to let your users update any kind of file, or ",(0,r.jsx)(a.a,{href:"#upload-an-image",children:"image upload"})," for image resizing."]}),"\n",(0,r.jsxs)(a.p,{children:["A ",(0,r.jsx)(a.code,{children:"public/storage"})," folder is automatically created when needed. Uploaded files and images will be renamed with a unique name and stored in a specific folder based on entity and property name, ending by a folder with the current month name to prevent having too many files in a single folder."]}),"\n",(0,r.jsxs)(a.p,{children:["Example: ",(0,r.jsx)(a.em,{children:"public/storage/project/contract/Nov24/8dab3936m1p54a66-contract.pdf"})]}),"\n",(0,r.jsx)(a.admonition,{type:"warning",children:(0,r.jsx)(a.p,{children:"If you want to set this file as an item's property, you need to upload the file first and then add the new uploaded file path as the property value creating or updating a record."})}),"\n",(0,r.jsx)(a.h2,{id:"add-a-base_url-variable",children:"Add a BASE_URL variable"}),"\n",(0,r.jsx)(a.p,{children:"Manifest stores absolute paths for convenience."}),"\n",(0,r.jsxs)(a.p,{children:["By default the base url is set to ",(0,r.jsx)(a.code,{children:"http://localhost:${port}"})," but you can change it using the ",(0,r.jsx)(a.code,{children:"BASE_URL"})," environment variable in your ",(0,r.jsx)(a.code,{children:".env"})," file to adapt to your own base URL."]}),"\n",(0,r.jsxs)(a.p,{children:["Example: ",(0,r.jsx)(a.code,{children:"BASE_URL=https://example.com"}),"."]}),"\n",(0,r.jsx)(a.admonition,{type:"warning",children:(0,r.jsxs)(a.p,{children:["Changing the ",(0,r.jsx)(a.code,{children:"BASE_URL"})," will not change the path of images and files that are already stored but it will impact the new ones."]})}),"\n",(0,r.jsx)(a.h2,{id:"upload-a-file",children:"Upload a file"}),"\n",(0,r.jsxs)(a.p,{children:["A file should be related to a property with the ",(0,r.jsx)(a.a,{href:"/docs/entities#file",children:"file property type"}),"."]}),"\n",(0,r.jsxs)(o.A,{children:[(0,r.jsx)(s.A,{value:"sdk",label:"JS SDK",default:!0,children:(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-js",children:"\n// Create a Blob, adapt this step to your use case.\nconst file = new Blob(['Hello, this is a test file!'], {\n  type: 'text/plain',\n})\n\n// Upload a file that will be used as a contract for an invoice.\nconst file = await manifest.from('invoices').upload('contract', file)\n\nconsole.log(file)\n// Output: {\"path\":\"http://localhost:1111/invoices/contract/Oct2024/8dabo9qm1q3swvu-my-contract.pdf\"}\n\n\n// Then you can store the path in the database.\nconst invoice = await manifest.from('invoices').create({\n  name: 'Invoice ACME',\n  contract: file.path\n})\n"})})}),(0,r.jsx)(s.A,{value:"rest",label:"REST API",default:!0,children:(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-http",children:'// Upload file.\nPOST /api/upload/file\nContent-Type: multipart/form-data\n{\n    file: (binary)\n    entity: invoices\n    property: contract\n}\n\n// Response.\n{\n    "path":"http://localhost:1111/invoices/contract/Oct2024/8dabo9qm1q3swvu-my-contract.pdf"\n}\n'})})})]}),"\n",(0,r.jsx)(a.h2,{id:"upload-an-image",children:"Upload an image"}),"\n",(0,r.jsxs)(a.p,{children:["An image should be related to a property with the ",(0,r.jsx)(a.a,{href:"/docs/entities#image",children:"image property type"}),". Manifest accepts ",(0,r.jsx)(a.strong,{children:".PNG"})," and ",(0,r.jsx)(a.strong,{children:".JPG"})," images only."]}),"\n",(0,r.jsxs)(a.p,{children:["Each image uploaded will be optimized and resized into several sizes based on ",(0,r.jsx)(a.a,{href:"/docs/entities#property-params",children:"the property parameters"}),". By default it generates a ",(0,r.jsx)(a.em,{children:"thumbnail"})," of 80x80 and a ",(0,r.jsx)(a.em,{children:"medium"})," of 160x160"]}),"\n",(0,r.jsxs)(o.A,{children:[(0,r.jsx)(s.A,{value:"sdk",label:"JS SDK",default:!0,children:(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-js",children:"// Create a Blob from an image, adapt this step to your use case.\nconst base64Image =\n  'iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/wcAAwAB/eb7jLwAAAAASUVORK5CYII='\nconst imageBlob: Blob = base64ToBlob(base64Image, 'image/png')\n\n// Upload the image.\nconst image = await manifest.from('cats').uploadImage('avatar', imageBlob)\n\nconsole.log(image)\n// Output: {\n// \"medium\": \"http://localhost:1111/cats/avatar/Oct2024/8dabo9qm1q4n1nk-medium.jpg\",\n// \"thumbnail\": \"http://localhost:1111/cats/avatar/Oct2024/8dabo9qm1q4n1nk-thumbnail.jpg\"\n// }\n\n// Then you can store the path in the database.\nconst cat = await manifest.from('cats').create({\n  name: 'Felix',\n  image: image\n})\n"})})}),(0,r.jsx)(s.A,{value:"rest",label:"REST API",default:!0,children:(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-http",children:'// Upload image.\nPOST /api/upload/image\nContent-Type: multipart/form-data\n{\n    image: (binary)\n    entity: cats\n    property: avatar\n}\n\n// Response.\n{\n "medium": "http://localhost:1111/cats/avatar/Oct2024/8dabo9qm1q4n1nk-medium.jpg",\n "thumbnail": "http://localhost:1111/cats/avatar/Oct2024/8dabo9qm1q4n1nk-thumbnail.jpg"\n}\n'})})})]})]})}function h(e={}){const{wrapper:a}={...(0,l.R)(),...e.components};return a?(0,r.jsx)(a,{...e,children:(0,r.jsx)(p,{...e})}):p(e)}},9329:(e,a,t)=>{t.d(a,{A:()=>o});t(6540);var n=t(4164);const r={tabItem:"tabItem_Ymn6"};var l=t(4848);function o(e){let{children:a,hidden:t,className:o}=e;return(0,l.jsx)("div",{role:"tabpanel",className:(0,n.A)(r.tabItem,o),hidden:t,children:a})}},5537:(e,a,t)=>{t.d(a,{A:()=>A});var n=t(6540),r=t(4164),l=t(5627),o=t(6347),s=t(372),i=t(604),c=t(1861),d=t(8749);function u(e){return n.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,n.isValidElement)(e)&&function(e){const{props:a}=e;return!!a&&"object"==typeof a&&"value"in a}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function p(e){const{values:a,children:t}=e;return(0,n.useMemo)((()=>{const e=a??function(e){return u(e).map((e=>{let{props:{value:a,label:t,attributes:n,default:r}}=e;return{value:a,label:t,attributes:n,default:r}}))}(t);return function(e){const a=(0,c.XI)(e,((e,a)=>e.value===a.value));if(a.length>0)throw new Error(`Docusaurus error: Duplicate values "${a.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[a,t])}function h(e){let{value:a,tabValues:t}=e;return t.some((e=>e.value===a))}function m(e){let{queryString:a=!1,groupId:t}=e;const r=(0,o.W6)(),l=function(e){let{queryString:a=!1,groupId:t}=e;if("string"==typeof a)return a;if(!1===a)return null;if(!0===a&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:a,groupId:t});return[(0,i.aZ)(l),(0,n.useCallback)((e=>{if(!l)return;const a=new URLSearchParams(r.location.search);a.set(l,e),r.replace({...r.location,search:a.toString()})}),[l,r])]}function f(e){const{defaultValue:a,queryString:t=!1,groupId:r}=e,l=p(e),[o,i]=(0,n.useState)((()=>function(e){let{defaultValue:a,tabValues:t}=e;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(a){if(!h({value:a,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${a}" but none of its children has the corresponding value. Available values are: ${t.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return a}const n=t.find((e=>e.default))??t[0];if(!n)throw new Error("Unexpected error: 0 tabValues");return n.value}({defaultValue:a,tabValues:l}))),[c,u]=m({queryString:t,groupId:r}),[f,b]=function(e){let{groupId:a}=e;const t=function(e){return e?`docusaurus.tab.${e}`:null}(a),[r,l]=(0,d.Dv)(t);return[r,(0,n.useCallback)((e=>{t&&l.set(e)}),[t,l])]}({groupId:r}),g=(()=>{const e=c??f;return h({value:e,tabValues:l})?e:null})();(0,s.A)((()=>{g&&i(g)}),[g]);return{selectedValue:o,selectValue:(0,n.useCallback)((e=>{if(!h({value:e,tabValues:l}))throw new Error(`Can't select invalid tab value=${e}`);i(e),u(e),b(e)}),[u,b,l]),tabValues:l}}var b=t(9136);const g={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var v=t(4848);function x(e){let{className:a,block:t,selectedValue:n,selectValue:o,tabValues:s}=e;const i=[],{blockElementScrollPositionUntilNextRender:c}=(0,l.a_)(),d=e=>{const a=e.currentTarget,t=i.indexOf(a),r=s[t].value;r!==n&&(c(a),o(r))},u=e=>{let a=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const t=i.indexOf(e.currentTarget)+1;a=i[t]??i[0];break}case"ArrowLeft":{const t=i.indexOf(e.currentTarget)-1;a=i[t]??i[i.length-1];break}}a?.focus()};return(0,v.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.A)("tabs",{"tabs--block":t},a),children:s.map((e=>{let{value:a,label:t,attributes:l}=e;return(0,v.jsx)("li",{role:"tab",tabIndex:n===a?0:-1,"aria-selected":n===a,ref:e=>{i.push(e)},onKeyDown:u,onClick:d,...l,className:(0,r.A)("tabs__item",g.tabItem,l?.className,{"tabs__item--active":n===a}),children:t??a},a)}))})}function j(e){let{lazy:a,children:t,selectedValue:l}=e;const o=(Array.isArray(t)?t:[t]).filter(Boolean);if(a){const e=o.find((e=>e.props.value===l));return e?(0,n.cloneElement)(e,{className:(0,r.A)("margin-top--md",e.props.className)}):null}return(0,v.jsx)("div",{className:"margin-top--md",children:o.map(((e,a)=>(0,n.cloneElement)(e,{key:a,hidden:e.props.value!==l})))})}function y(e){const a=f(e);return(0,v.jsxs)("div",{className:(0,r.A)("tabs-container",g.tabList),children:[(0,v.jsx)(x,{...a,...e}),(0,v.jsx)(j,{...a,...e})]})}function A(e){const a=(0,b.A)();return(0,v.jsx)(y,{...e,children:u(e.children)},String(a))}},8453:(e,a,t)=>{t.d(a,{R:()=>o,x:()=>s});var n=t(6540);const r={},l=n.createContext(r);function o(e){const a=n.useContext(l);return n.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function s(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),n.createElement(l.Provider,{value:a},e.children)}}}]);