"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[112],{9304:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"middlewares","title":"Middlewares","description":"Introduction","source":"@site/content/middlewares.md","sourceDirName":".","slug":"/middlewares","permalink":"/docs/middlewares","draft":false,"unlisted":false,"editUrl":"https://github.com/mnfst/docs/blob/master/middlewares.md","tags":[],"version":"current","frontMatter":{"id":"middlewares","title":"Middlewares"},"sidebar":"docSidebar","previous":{"title":"Webhooks","permalink":"/docs/webhooks"},"next":{"title":"Uploads","permalink":"/docs/upload"}}');var r=n(4848),d=n(8453);const a={id:"middlewares",title:"Middlewares"},i=void 0,l={},o=[{value:"Introduction",id:"introduction",level:2},{value:"Middleware use cases",id:"middleware-use-cases",level:2},{value:"Syntax",id:"syntax",level:2},{value:"Use your data with the Manifest backend SDK",id:"use-your-data-with-the-manifest-backend-sdk",level:2},{value:"Events",id:"events",level:2}];function c(e){const t={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.h2,{id:"introduction",children:"Introduction"}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"Middleware functions"})," or ",(0,r.jsx)(t.strong,{children:"middlewares"})," are intermediary functions that sit between the client's request and the server's response. They have access to the request object (req) and the response object (res)."]}),"\n",(0,r.jsxs)(t.p,{children:["As Manifest works with ",(0,r.jsx)(t.strong,{children:"ExpressJS"}),", Manifest middlewares are ",(0,r.jsx)(t.a,{href:"https://expressjs.com/en/guide/using-middleware.html",children:"ExpressJS middlewares"})," enhanced with the ",(0,r.jsx)(t.a,{href:"/docs/crud#using-the-javascript-sdk",children:"Manifest SDK"})," that allows you to interact with your data with ease."]}),"\n",(0,r.jsx)(t.h2,{id:"middleware-use-cases",children:"Middleware use cases"}),"\n",(0,r.jsx)(t.p,{children:"Here are some examples of middleware use cases:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Patch the request body before storing it in the DB"}),"\n",(0,r.jsx)(t.li,{children:"Call an external API or any other custom logic"}),"\n",(0,r.jsx)(t.li,{children:"Hide some data from the response"}),"\n",(0,r.jsxs)(t.li,{children:["Trigger an internal or external action on an event (see also ",(0,r.jsx)(t.a,{href:"/docs/webhooks",children:"webhooks"}),")"]}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"syntax",children:"Syntax"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'title="manifest/backend.yml"',children:"entities:\n  Project \ud83d\uddc2\ufe0f:\n    properties:\n      - name\n      - { name: date, type: date }\n    middlewares:\n      beforeCreate:\n        - handler: setDate\n      afterCreate:\n        - handler: sendEmail\n"})}),"\n",(0,r.jsxs)(t.p,{children:["This example triggers the handler located at ",(0,r.jsx)(t.code,{children:"/manifest/handlers/setDate.js"})," before the item is created and stored in the database, and triggers ",(0,r.jsx)(t.code,{children:"/manifest/handlers/sendEmail.js"})," after."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-js",metastring:'title="manifest/handlers/setDate.js"',children:"module.exports = async (req, res) => {\n  console.log('Hello from the handler!')\n\n  req.body['date'] = new Date()\n}\n"})}),"\n",(0,r.jsx)(t.admonition,{type:"tip",children:(0,r.jsxs)(t.p,{children:["You can add ",(0,r.jsx)(t.strong,{children:"several middlewares"})," for an event. They will be processed sequentially in the order you define."]})}),"\n",(0,r.jsx)(t.h2,{id:"use-your-data-with-the-manifest-backend-sdk",children:"Use your data with the Manifest backend SDK"}),"\n",(0,r.jsxs)(t.p,{children:["Manifest passes the ",(0,r.jsx)(t.a,{href:"/docs/crud#using-the-javascript-sdk",children:"JS SDK"})," to handler functions as third argument. You can use it to fetch or write data."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-js",metastring:'title="manifest/handlers/patchDocumentNameIfEmpty.js"',children:"module.exports = async (req, res, manifest) => {\n  // If the 'name' property of the item is empty.\n  if (!req.body['name']) {\n    // Get the user from the request body.\n    const user = await manifest.from('users').findOneById(req.body['userId'])\n\n    // Set a custom name based on the user.\n    req.body['name'] = `${user.name}'s untitled document`\n  }\n}\n"})}),"\n",(0,r.jsx)(t.h2,{id:"events",children:"Events"}),"\n",(0,r.jsxs)(t.p,{children:["This is the list and description of the 6 events available to which you can attach middlewares. All of them are related to an ",(0,r.jsx)(t.a,{href:"/docs/entities",children:"entity"})]}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Name"}),(0,r.jsx)(t.th,{children:"Description"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.strong,{children:"beforeCreate"})}),(0,r.jsx)(t.td,{children:"Before creating a record"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.strong,{children:"afterCreate"})}),(0,r.jsx)(t.td,{children:"After creating a record"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.strong,{children:"beforeUpdate"})}),(0,r.jsx)(t.td,{children:"Before updating a record"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.strong,{children:"afterUpdate"})}),(0,r.jsx)(t.td,{children:"After updating a record"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.strong,{children:"beforeDelete"})}),(0,r.jsx)(t.td,{children:"Before deleting a record"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.strong,{children:"afterDelete"})}),(0,r.jsx)(t.td,{children:"After deleting a record"})]})]})]})]})}function h(e={}){const{wrapper:t}={...(0,d.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>i});var s=n(6540);const r={},d=s.createContext(r);function a(e){const t=s.useContext(d);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),s.createElement(d.Provider,{value:t},e.children)}}}]);